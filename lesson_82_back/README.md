# Lesson_82_back (music-api)

> Lesson_82_back (music-api) - это API для музыкального приложения.

## Установка

> Используйте такой способ установки проекта:

```bash
git clone ssh://git@git.attractor-school.com:30022/Ibragimova_Tatyana/lesson_82.git
cd lesson_82_back
npm install
npm run dev # для разработки 
NODE_ENV=production node index.js # для продакшена 
```
> В основе работы API - база данных MongoDB.

## Использование
### GET /artists

> Запрос на получение всех исполнителей. Возвращает массив с объектами вида: 

```
[{
    _id: ObjectId, 
    name: String,
    info: String,
    photo: String,
    __v: Number
}]
```
> Поля `info` и `photo` являются необязательными в запросе.

### POST /artists

> Запрос на отправку нового исполнителя. Возвращает объект вида с отправленными данными:

```
{
    _id: ObjectId, 
    name: String,
    info: String,
    photo: String,
    __v: Number
}
```
> Поля `info` и `photo` являются необязательными в запросе.
_________________


### GET /albums

> Запрос на получение всех альбомов. Возвращает массив с объектами вида: 

```
[{
    _id: ObjectId,
    title: String,
    year: Number,
    artist: ObjectId,
    cover: String,
    __v: Number
}]
```
 > Поля `year` и `cover` являются необязательными в запросе.


Поле `artist` в ответе содержит идентификатор исполнителя (`_id`), при этом на основе связанной модели `Artist`, возвращается также объект с данными о каждом исполнителе альбома вида:
```
{
    _id: ObjectId, 
    name: String,
    info: String,
    photo: String,
    __v: Number
}
```

### GET /albums?artist= 
после знака "=" добавляется параметр исполнитель (artist) в формате идентификатора(`_id`), например:
`607e9d6dda285d66148db521`

> Запрос на получение всех альбомов указанного исполнителя. Возвращается массив с объектами вида:

```
[{
    _id: ObjectId,
    title: String,
    year: Number,
    artist: ObjectId,
    cover: String,
    __v: Number
}]

```
 > Поля `year` и `cover` являются необязательными в запросе.


Поле `artist` в ответе содержит переданный идентификатор исполнителя (`_id`), при этом на основе связанной модели `Artist`, возвращается также объект с данными о соответствующем исполнителе вида:
```
{
    _id: ObjectId, 
    name: String,
    info: String,
    photo: String,
    __v: Number
}
```

В `_id` поле `artist`  у всех возвращенных объектов значение переданного query-параметра.

### GET /albums/:id
после знака "/" добавляется id соответствующего альбома в формате идентификатора(`_id`), например:
`607eb37a5776323784ab583a`

> Запрос на получение информации о конкретном альбоме, включая информацию о его исполнителе. Возвращается объект вида:

```
{
    _id: ObjectId,
    title: String,
    year: Number,
    artist: ObjectId,
    cover: String,
    __v: Number
}
```
 > Поля `year` и `cover` являются необязательными в запросе.

Поле `artist` в ответе содержит переданный идентификатор исполнителя (`_id`), при этом на основе связанной модели `Artist`, возвращается также объект с данными об исполнителе соответствующего альбома вида:
```
{
    _id: ObjectId, 
    name: String,
    info: String,
    photo: String,
    __v: Number
}
```

### POST /albums

> Запрос на отправку нового альбома. Возвращает объект вида с отправленными данными:

```
{
    _id: ObjectId,
    title: String,
    year: Number,
    artist: ObjectId,
    cover: String,
    __v: Number
}
```
 > Поля `year` и `cover` являются необязательными в запросе.
_________________


### GET /tracks

> Запрос на получение всех треков. Возвращает массив с объектами вида: 

```
[{
    _id: ObjectId,
    title: String,
    album: ObjectId,
    duration: String,
    __v: Number
}]
```

Поле `album` в ответе содержит идентификатор альбома (`_id`), при этом на основе связанной модели `Album`, возвращается также объект с данными о каждом альбоме, которому принадлежит трек, вида:
```
{
    _id: ObjectId, 
    title: String,
    artist: ObjectId,
    year: String,
    cover: String,
    __v: Number
}
```

### GET /tracks?album= 
после знака "=" добавляется параметр альбом (album) в формате идентификатора(`_id`), например:
`607eb4ba5776323784ab583b`

> Запрос на получение всех треков из конкретного альбома. Возвращается массив с объектами вида:

```
[{
    _id: ObjectId,
    title: String,
    album: ObjectId
    duration: String,
    __v: Number
}]

```
Поле `album` в ответе содержит переданный идентификатор исполнителя (`_id`), при этом на основе связанной модели `Album`, возвращается также объект с данными о соответствующем альбоме вида:
```
{
    _id: ObjectId, 
    name: String,
    info: String,
    photo: String,
    __v: Number
}
```

В `_id` поле `album` у всех возвращенных объектов значение переданного query-параметра.


### GET /tracks?artist= 
после знака "=" добавляется параметр исполнитель (artist) в формате идентификатора(`_id`), например:
`607e9d6dda285d66148db521`

> Запрос на получение всех треков конкретного исполнителя. Возвращается массив с объектами вида:

```
[{
    _id: ObjectId,
    title: String,
    album: ObjectId
    duration: String,
    __v: Number
}]

```

### POST /tracks

> Запрос на отправку нового трека. Возвращает объект вида с отправленными данными:

```
{
    _id: ObjectId,
    title: String,
    album: ObjectId,
    duration: String,
    __v: Number
}
```
_________________


### POST /users

> Запрос на регистрацию (создание) нового пользователя. Возвращает объект с отправленными данными вида :

```
{
    _id: ObjectId,
    username: String,
    token: String,
    __v: Number
}
```

`Поле "token" представляет собой сгенерированную зависимостью nanoid строку при успешной регистрации пользователя. Значение поля "token" является авторизационным токеном и его следует добавить в авторизационный заголовок дальнейших запросов использующих данные пользователя.`

### POST /users/sessions

> Запрос на логин пользователя. Возвращает объект с отправленными данными вида :

```
{
    _id: ObjectId,
    username: String,
    token: String,
    __v: Number
}
```

`Поле "token" представляет собой сгенерированную зависимостью nanoid строку при успешной регистрации пользователя, т.е. соответствия вводимых пользователем данных username и password, данным о соответствующем пользователе, хранящимся  в БД. Значение поля "token" является авторизационным токеном и его следует добавить в авторизационный заголовок дальнейших запросов использующих данные пользователя.`
_________________


### POST /track_history

> Запрос на добавление прослушанного трека в историю для конкретного пользователя. Для отправки запроса в авторизационный заголовок запроса дребуется добавить значение авторизациооного токена пользователя. Возвращает объект с отправленными данными вида :

```
{
    _id: ObjectId,
    user: ObjectId,
    track: ObjectId,
    datetime: String
    __v: Number
}
```

Поле `user` в ответе содержит идентификатор пользователя (`_id`), при этом на основе связанной модели `User`, возвращается также объект с данными об этом пользователе, вида:
```
{
    _id: ObjectId, 
    username: String,
    token: String,
    __v: Number
}
```

Поле `track` в ответе содержит идентификатор трека (`_id`), при этом на основе связанной модели `Track`, возвращается также объект с данными об этом треке, вида:
```
{
    _id: ObjectId, 
    title: String,
    album: ObjectId,
    duration: String,
    __v: Number
}
```